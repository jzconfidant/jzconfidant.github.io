<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Z-Wave," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="All Switch [OBSOLETED]New implementations MUST NOT support this Command Class. Controlling nodes MUST use S2 Multicast mechanism in order to achieve the All On and All Off functionality Basic CCThe B">
<meta name="keywords" content="Z-Wave">
<meta property="og:type" content="article">
<meta property="og:title" content="Z-Wave Command Class">
<meta property="og:url" content="http://blog.godoit.xyz/2018/05/20/Z-Wave_CC/index.html">
<meta property="og:site_name" content="GODOIT">
<meta property="og:description" content="All Switch [OBSOLETED]New implementations MUST NOT support this Command Class. Controlling nodes MUST use S2 Multicast mechanism in order to achieve the All On and All Off functionality Basic CCThe B">
<meta property="og:image" content="https://i.imgur.com/JJaR4E4.png">
<meta property="og:updated_time" content="2018-05-26T07:20:59.421Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Z-Wave Command Class">
<meta name="twitter:description" content="All Switch [OBSOLETED]New implementations MUST NOT support this Command Class. Controlling nodes MUST use S2 Multicast mechanism in order to achieve the All On and All Off functionality Basic CCThe B">
<meta name="twitter:image" content="https://i.imgur.com/JJaR4E4.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.godoit.xyz/2018/05/20/Z-Wave_CC/"/>





  <title> Z-Wave Command Class | GODOIT </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">GODOIT</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://blog.godoit.xyz/2018/05/20/Z-Wave_CC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="AamHo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GODOIT">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Z-Wave Command Class
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-20T13:14:00+08:00">
                2018-05-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IoT/" itemprop="url" rel="index">
                    <span itemprop="name">IoT</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IoT/Z-Wave/" itemprop="url" rel="index">
                    <span itemprop="name">Z-Wave</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/20/Z-Wave_CC/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/05/20/Z-Wave_CC/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/05/20/Z-Wave_CC/" class="leancloud_visitors" data-flag-title="Z-Wave Command Class">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="https://i.imgur.com/JJaR4E4.png" alt=""></p>
<h1 id="All-Switch-OBSOLETED"><a href="#All-Switch-OBSOLETED" class="headerlink" title="All Switch [OBSOLETED]"></a>All Switch [OBSOLETED]</h1><p>New implementations MUST NOT support this Command Class. Controlling nodes MUST use S2 Multicast mechanism in order to achieve the All On and All Off functionality</p>
<h1 id="Basic-CC"><a href="#Basic-CC" class="headerlink" title="Basic CC"></a>Basic CC</h1><p>The Basic Command Class MUST NOT be advertised in the Node Information Frame.</p>
<p>The Basic Command Class MUST NOT be advertised in the Security Commands Supported Report (S0 as well as S2)</p>
<p>A securely included node MAY support the Basic Command Class at the highest security level but it MUST NOT support the Basic Command Class at any lower security level or non-securely.</p>
<h1 id="Association-CC"><a href="#Association-CC" class="headerlink" title="Association CC"></a>Association CC</h1><h1 id="Association-Group-Information-CC-AGI"><a href="#Association-Group-Information-CC-AGI" class="headerlink" title="Association Group Information CC (AGI)"></a>Association Group Information CC (AGI)</h1><p>If a node implements Multi Channel End Points and supports the AGI Command Class, each individual End Point MUST support the AGI Command Class.</p>
<p>A manufacturer MAY add additional commands to the Lifeline group. Refer to </p>
<blockquote>
<p>Sigma Designs, SDS11847, Z-Wave Plus Device Types Specification.</p>
</blockquote>
<p>A node MAY send additional commands via the lifeline association group to reflect the state of the node. A node MUST NOT send the following via the lifeline:</p>
<ul>
<li>Obsoleted commands or commands belonging to an obsoleted Command Class</li>
<li>Set or Get commands</li>
<li>Redundant commands. (for example, if Multilevel Switch CC and Window Covering CC provide the same functionality for a node, the node MUST NOT send both Multilevel Switch Report and Window Covering Report)</li>
</ul>
<h3 id="Profile"><a href="#Profile" class="headerlink" title="Profile"></a>Profile</h3><ul>
<li>General profiles</li>
<li>Control profiles</li>
<li>Sensor profiles</li>
<li>Notification profiles</li>
</ul>
<h1 id="Multi-Channel-CC"><a href="#Multi-Channel-CC" class="headerlink" title="Multi Channel CC"></a>Multi Channel CC</h1><p>A node supporting this Command Class MUST set the Optional Functionality bit in its NIF.</p>
<p>A Multi Channel device MAY implement from 1 to 127 end points.</p>
<p>A Multi Channel device MUST implement all application functionality in End Points. </p>
<p>Multi Channel Encapsulation is not used between Root Devices.</p>
<p>A controlling device MAY use Multi Channel encapsulation to communicate with Multi Channel End Points in other devices. If such a controlling device does not implement any End Points, the device MUST NOT advertise the Multi Channel Command Class in the Node Information Frame.</p>
<p>It is seen that the mapping of application functionality to the Root Device depends heavily on the actual product feature set. However, a few principles apply:</p>
<ol>
<li>The Root Device provides access to the primary functionality of the actual product.</li>
<li>The Root Device of a Multi Channel device does not implement any application functionality that cannot be reached via End Points.</li>
<li>The Root Device of a Multi Channel always presents functionality, which can also be reached via End Point 1. If it makes sense in the actual product, a Root Device command may affect more End Points than End Point 1.</li>
</ol>
<p>The Root Device SHOULD NOT advertise the application functionality of any dynamic End Point.</p>
<p>The Root Device of a Multi Channel device MUST NOT advertise any application functionality that cannot be reached via one or more End Points.</p>
<h1 id="Multi-Channel-Association-CC"><a href="#Multi-Channel-Association-CC" class="headerlink" title="Multi Channel Association CC"></a>Multi Channel Association CC</h1><p>A controlling device SHOULD NOT create End Point associations to dynamic Multi Channel End Points.</p>
<p>End Points SHOULD NOT implement the Lifeline Association Group. End Points SHOULD report that zero NodeIDs are supported for association group 1</p>
<h1 id="Wake-Up-CC"><a href="#Wake-Up-CC" class="headerlink" title="Wake Up CC"></a>Wake Up CC</h1><p>The Wake Up period starts when the supporting node issues a Wake Up Notification and it ends either 10 seconds after the last received/transmitted frame or at the reception of a Wake Up No More Information Command by the Wake Up destination.</p>
<p>The Wake Up Notification Command Class MUST NOT be covered by any association group. This also means that the Wake Up Notification Command Class MUST NOT be covered by the Lifeline association group.</p>
<p>A node sending periodical or triggered unsolicited commands at the same time it wakes up SHOULD send the unsolicited commands before the Wake Up Notification Command.</p>
<p>A supporting node SHOULD NOT send unsolicited commands during the Wake Up period.</p>
<h1 id="Clock-CC"><a href="#Clock-CC" class="headerlink" title="Clock CC"></a>Clock CC</h1><p>A supporting node SHOULD NOT learn the current time with a Clock Get Command. </p>
<p>A node SHOULD control the <strong>Time Command Class</strong> to read the current time from supporting nodes (time servers) or support the Clock Command Class and wait to be set the current time by a controlling node.</p>
<p>A Z-Wave Plus node SHOULD issue a Clock Report Command via the Lifeline Association Group if they suspect to have inaccurate time and/or weekdays (e.g. after battery removal). </p>
<h1 id="Time-CC"><a href="#Time-CC" class="headerlink" title="Time CC"></a>Time CC</h1><p>A supporting node MUST always advertise the Time Command Class in its NIF, regardless of the security bootstrapping outcome. </p>
<p>For nodes based on a slave Role Type, it is RECOMMENDED to support a dedicated Association Group which issues the Time Get Command and/or the Date Get Command. </p>
<h1 id="Time-Parameters-CC"><a href="#Time-Parameters-CC" class="headerlink" title="Time Parameters CC"></a>Time Parameters CC</h1><h1 id="Schedule-CC"><a href="#Schedule-CC" class="headerlink" title="Schedule CC"></a>Schedule CC</h1><h1 id="Central-Scene-CC"><a href="#Central-Scene-CC" class="headerlink" title="Central Scene CC"></a>Central Scene CC</h1><p>Virtual buttons MUST be numbered after physical push buttons or graphical button objects.</p>
<p>In order to ensure a functioning network, the Slow Refresh capability MUST be enabled by default after inclusion.</p>
<p>Multi Channel End Points SHOULD NOT support the Central Scene Command Class.</p>
<h1 id="Multilevel-Sensor-CC"><a href="#Multilevel-Sensor-CC" class="headerlink" title="Multilevel Sensor CC"></a>Multilevel Sensor CC</h1>
      
    </div>

    <div>
      
        
<div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/uploads/wechat-qcode.jpg" alt="AamHo wechat" style="width: 200px; max-width: 100%;"/>
    <div>欢迎扫描上面的微信公众号，订阅我的博客！</div>
</div>


      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Z-Wave/" rel="tag"># Z-Wave</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/05/20/Z-Wave_Certification/" rel="next" title="Z-Wave Certification">
                <i class="fa fa-chevron-left"></i> Z-Wave Certification
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/09/07/ESP8266开发之前期准备/" rel="prev" title="ESP8266开发之前期准备">
                ESP8266开发之前期准备 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="AamHo" />
          <p class="site-author-name" itemprop="name">AamHo</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/jzconfidant" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/jzconfidant" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#All-Switch-OBSOLETED"><span class="nav-text">All Switch [OBSOLETED]</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Basic-CC"><span class="nav-text">Basic CC</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Association-CC"><span class="nav-text">Association CC</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Association-Group-Information-CC-AGI"><span class="nav-text">Association Group Information CC (AGI)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Profile"><span class="nav-text">Profile</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Multi-Channel-CC"><span class="nav-text">Multi Channel CC</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Multi-Channel-Association-CC"><span class="nav-text">Multi Channel Association CC</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Wake-Up-CC"><span class="nav-text">Wake Up CC</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Clock-CC"><span class="nav-text">Clock CC</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Time-CC"><span class="nav-text">Time CC</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Time-Parameters-CC"><span class="nav-text">Time Parameters CC</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Schedule-CC"><span class="nav-text">Schedule CC</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Central-Scene-CC"><span class="nav-text">Central Scene CC</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Multilevel-Sensor-CC"><span class="nav-text">Multilevel Sensor CC</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">AamHo</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  








  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://Aamir.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://blog.godoit.xyz/2018/05/20/Z-Wave_CC/';
          this.page.identifier = '2018/05/20/Z-Wave_CC/';
          this.page.title = 'Z-Wave Command Class';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://Aamir.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  





  





  






  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("xSXTehxzGqnSDkxWV7igrvMv-gzGzoHsz", "OwJNxQBQxRRW3s9t0Mpk6sJ6");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

</body>
</html>
